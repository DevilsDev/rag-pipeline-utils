{
  "batchId": 3,
  "timestamp": "2025-08-10T23:16:12+12:00",
  "priority": "P1",
  "category": "Mocks & CLI/Config",
  "description": "Mock/contract drift, CLI/Config schema strictness, and default coercions",
  "targetFiles": [
    "__tests__/unit/plugins/plugin-registry.test.js",
    "__tests__/unit/cli/enhanced-cli.test.js",
    "__tests__/unit/config/load-config.test.js",
    "__tests__/fixtures/src/mocks/openai-llm.js",
    "__tests__/fixtures/src/mocks/pinecone-retriever.js",
    "__tests__/utils/mock-factory.js",
    "src/config/validate-schema.js",
    "__tests__/integration/cli/config-flow.test.js"
  ],
  "estimatedTests": 30,
  "expectedIssues": [
    "Mock/contract drift (method renames: ask→generate, _type→type)",
    "Missing required fields in mock responses",
    "CLI/Config JSON Schema strictness vs defaults",
    "Schema validation error messages not actionable",
    "Mock factory centralization needed",
    "Contract validation mismatches"
  ],
  "fixPatterns": [
    "mockContract",
    "cliSchema",
    "centralized_mocks",
    "schema_defaults"
  ],
  "allowedFixes": [
    "Update mocks to current contracts (ask→generate, _type→type, required fields)",
    "Centralize helpers in __tests__/utils/mock-factory.js",
    "Enforce schema defaults in loaders, not by weakening schema",
    "Validate via programmatic tests, keep error messages actionable"
  ],
  "guardrails": {
    "maxRegressions": 0,
    "maxRetries": 2,
    "rollbackOnFailure": true,
    "requireNetDecrease": true
  },
  "baseline": {
    "totalTests": 446,
    "failedTests": 140,
    "passRate": 68.6,
    "failedSuites": 38
  },
  "dependsOn": "batch-2"
}
