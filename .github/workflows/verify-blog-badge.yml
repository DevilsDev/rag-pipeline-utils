name: üñç Blog Badge Verification
'on':
  workflow_dispatch: null
  workflow_run:
    workflows:
      - Auto Generate Blog + Changelog
    types:
      - completed
jobs:
  verify:
    name: üåü Verify Blog Badge and Output
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: ‚¨áÔ∏è Checkout repository
        uses: actions/checkout@v4
      - name: üîç Validate README badge reference
        run: |
          echo "Checking for badge reference in README.md..."
          grep -q "post-release-generate-blog.yml/badge.svg" README.md || {
            echo "‚ùå Missing badge for post-release-generate-blog.yml in README.md"
            exit 1
          }
      - name: üåê Validate badge URL status
        run: >
          BADGE_URL="https://github.com/DevilsDev/rag-pipeline-utils/actions/workflows/post-release-generate-blog.yml/badge.svg?branch=main"

          STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$BADGE_URL")


          echo "Badge response: $STATUS"

          if [ "$STATUS" != "200" ]; then
            echo "‚ùå Blog badge not reachable (HTTP $STATUS)"
            exit 1
          fi
      - name: üßæ Log assumed blog generation output (manual mapping)
        run: |
          echo "‚ö†Ô∏è Outputs from 'workflow_run' do not include job outputs."
          echo "Assuming blog_generated=true based on successful workflow completion."
      - name: ‚úÖ Blog badge verified
        run: echo "‚úÖ Blog badge verified and present in README."
concurrency:
  concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true
permissions:
  permissions:
    contents: read
