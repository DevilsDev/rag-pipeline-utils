name: üñç Blog Badge Verification (Security Hardened)
"on":
  workflow_dispatch:
  workflow_run:
    workflows:
      - Auto Generate Blog + Changelog
    types:
      - completed
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
permissions:
  contents: read
  actions: read
jobs:
  verify:
    name: üåü Verify Blog Badge and Output
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: ‚¨áÔ∏è Checkout repository
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332
      - name: üîç Validate README badge reference
        run: |
          set -e
          set -o pipefail
          echo "Checking for badge reference in README.md..."
          grep -q "post-release-generate-blog.yml/badge.svg" README.md || {
            echo "‚ùå Missing badge for post-release-generate-blog.yml in README.md"
            exit 1
          }
        shell: bash
      - name: üåê Validate badge URL status
        run: |
          set -e
          set -o pipefail
          BADGE_URL="https://github.com/DevilsDev/rag-pipeline-utils/actions/workflows/post-release-generate-blog.yml/badge.svg?branch=main"
          STATUS=$(curl -s -o /dev/null -w "%{http_code}" ""$BADGE_URL"")

          echo "Badge response: $STATUS"
          if [ ""$STATUS"" != "200" ]; then
            echo "‚ùå Blog badge not reachable (HTTP ${$STATUS}"")"
            exit 1
          fi
        shell: bash
      - name: üßæ Log assumed blog generation output (manual mapping)
        run: |
          set -e
          set -o pipefail
          echo "‚ö†Ô∏è Outputs from 'workflow_run' do not include job outputs."
          echo "Assuming blog_generated=true based on successful workflow completion."
        shell: bash
      - name: ‚úÖ Blog badge verified
        run: echo "‚úÖ Blog badge verified and present in README."
        shell: bash
    timeout-minutes: 30
