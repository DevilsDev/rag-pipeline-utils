name: Publish Release Blog Post (Security Hardened)
"on":
  release:
    types:
      - published
jobs:
  publish-blog-post:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout main branch
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332
        with:
          ref: main
          fetch-depth: 0
      - name: ðŸ”§ Set up Node.js
        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8
        with:
          node-version: 18
      - name: âœï¸ Generate blog post
        run: |
          set -e
          set -o pipefail
          VERSION="${GITHUB_REF#refs/tags/}"
          DATE=$(date +'%Y-%m-%d')
          FILE="docs-site/blog/"${DATE}"-release-"${VERSION}".md"

          echo "---" > "$FILE"
          echo "slug: release-"${VERSION}"" >> "$FILE"
          echo "title: âœ¨ Version "${VERSION}" Released" >> "$FILE"
          echo "authors: [ali]" >> "$FILE"
          echo "tags: [release, changelog]" >> "$FILE"
          echo "---" >> "$FILE"
          echo ">> $FILE"
          echo "RAG Pipeline Utils v"${VERSION}" is now available on NPM!" >> "$FILE"
          echo ">> $FILE"
          echo "#### Highlights" >> "$FILE"
          echo "- ðŸš€ Auto-published blog from GitHub Release" >> "$FILE"
          echo "- ðŸ“¦ Version bump: "${VERSION}"" >> "$FILE"
          echo "- ðŸ“˜ See CHANGELOG.md for full details" >> "$FILE"
        shell: bash
      - name: ðŸ“‹ Commit blog post
        uses: stefanzweifel/git-auto-commit-action@8621497c8c39c72f3e2a999a26b4ca1b5058a842
        with:
          commit_message: "docs(blog): add release post for ${{ github.ref_name }}"
          file_pattern: docs-site/blog/*.md
    timeout-minutes: 30
concurrency:
  concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true
permissions:
  contents: read
  actions: read
