name: ğŸ”– Sync Roadmap Labels (Security Hardened)
"on":
  workflow_dispatch: null
  push:
    paths:
      - .github/workflows/roadmap-labels.yml
jobs:
  sync-labels:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8
        with:
          node-version: 20
      - name: ğŸ“¦ Install octokit
        run: npm install octokit
        shell: bash
      - name: ğŸ”– Run label sync
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPO: ${{ github.repository }}
        run: |
          set -e
          set -o pipefail
          node <<EOF
          const { Octokit } = require("octokit");

          const octokit = new Octokit({ auth: process.env.GITHUB_TOKEN });
          const [owner, repo] = process.env.GITHUB_REPO.split("/");

          const labels = [
            { name: "priority: high", color: "e11d48", description: "High priority roadmap item" },
            { name: "priority: medium", color: "f59e0b", description: "Medium priority roadmap item" },
            { name: "priority: low", color: "10b981", description: "Low priority roadmap item" },
            { name: "group: docs", color: "6366f1", description: "Documentation features" },
            { name: "group: devx", color: "06b6d4", description: "Developer experience improvements" },
            { name: "group: community", color: "ec4899", description: "Community tools & engagement" },
            { name: "group: blog", color: "f97316", description: "Blog & SEO enhancements" },
            { name: "group: infra", color: "64748b", description: "Infrastructure & deployment features" }
          ];

          (async () => {
            const existing = await octokit.rest.issues.listLabelsForRepo({ owner, repo });
            const existingNames = new Set(existing.data.map(l => l.name));

            for (const label of labels) {
              if (!existingNames.has(label.name)) {
                console.log("$($1)");
                await octokit.rest.issues.createLabel({ owner, repo, ...label });
              } else {
                console.log("$($1)");
              }
            }
          })().catch(err => {
            console.error("Label sync failed:", err);
            process.exit(1);
          });
          EOF
        shell: bash
    timeout-minutes: 30
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
permissions:
  contents: read
  actions: read
