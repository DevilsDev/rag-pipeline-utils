name: ğŸ”„ Release Sync (Security Hardened)
"on":
  push:
    tags:
      - v*
    paths:
      - CHANGELOG.md
      - scripts/**
      - .github/workflows/release-sync.yml
permissions:
  contents: read
  actions: read
jobs:
  publish-release-blog:
    name: ğŸ“ Create Blog Post from CHANGELOG + Tag
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§¾ Checkout Repo
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332
        with:
          fetch-depth: 0
      - name: ğŸ§° Setup Node
        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8
        with:
          node-version: 20
      - name: ğŸ“¦ Install deps
        run: npm ci
        shell: bash
      - name: ğŸ” Generate blog post
        run: |
          set -e
          set -o pipefail
          VERSION="${GITHUB_REF#refs/tags/}"
          PREV=$(git tag --sort=committerdate | grep -B1 "$VERSION" | head -n1)
          node scripts/generate-release-note.js "$VERSION" "$PREV"
        shell: bash
      - name: ğŸ’¬ Commit release blog
        uses: stefanzweifel/git-auto-commit-action@8621497c8c39c72f3e2a999a26b4ca1b5058a842
        with:
          commit_message: "docs(blog): auto-publish release notes for ${{ github.ref_name }}"
          file_pattern: docs-site/blog/*.md
    timeout-minutes: 30
concurrency:
  concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true
